{% extends "base.html" %}
{% block content %}
<section class="card center">
  <h2>Resting‚Ä¶ üò¥‚è≥</h2>
  <div class="timer" id="timer"></div>

  <button class="btn" onclick="stopAlarm()">Stop Alarm</button>
  <p class="muted small"><a href="{{ url_for('detect') }}">Back to detection</a></p>
</section>

<script>
let total = {{ minutes|default(5)|tojson }} * 60;
let alarmPlaying = false;
const timerEl = document.getElementById('timer');

function beep() {
  if (alarmPlaying) return;
  alarmPlaying = true;
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  osc.connect(ctx.destination);
  osc.start();
  setTimeout(()=>osc.stop(), 1000);
}
function stopAlarm(){ alarmPlaying=false; window.location.href="{{ url_for('detect') }}"; }
function tick(){
  if (total <= 0) { timerEl.textContent = "Time up! üå§Ô∏è"; beep(); return; }
  const m = Math.floor(total/60), s = total%60;
  timerEl.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  total--; setTimeout(tick, 1000);
}
tick();
</script>
{% endblock %}
